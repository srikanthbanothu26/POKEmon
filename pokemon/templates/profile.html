<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <link rel="icon" href="{{ url_for('static', filename='img/Screenshot 2024-02-27 at 11-01-46 Colors LOGO.com1.ico') }}">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
</head>
<body class="text-black">
    <!-- Profile Section -->
    <div class="grid grid-cols-1">
        <div class="bg-red-700 h-96 w-56 grid grid-cols-1 justify-center items-center rounded-md">
            <div class="pl-8 pr-8">
                <div class="profile-image-container ml-16">
                    {% if current_user.profile_image %}
                    <img id="profile-image" src="{{ url_for('static', filename='profile_pics/' + current_user.profile_image) }}" class="h-24 w-24 rounded-full" alt="{{ current_user.name }}'s Profile Image" onerror="this.onerror=null;this.src='{{ url_for('static', filename='profile_pics/profile.png') }}';" />
                    {% else %}
                    <img id="profile-image" src="{{ url_for('static', filename='profile_pics/default.png') }}" class="h-16 w-16 rounded-full" alt="Default Profile Image">
                    {% endif %}
                </div>
                <button id="edit-profile-btn" class="ml-20 border-2 flex inline text-white rounded h-8 w-16">Update</button>
                <input type="file" id="file-upload" accept="image/*" style="display: none;">
                <button id="upload-btn" style="display: none;" class="bg-green-600">Upload</button>
                <p class="mt-8">name:{{current_user.name}}<p>
                <p>id:{{current_user.id}}</p>
                <p class="pr-10">email:{{current_user.email}}</p>
                <a href="/main" class="border border-white py-1 px-3 rounded-lg mt-8">LOGOUT</a>
            </div>
        </div>
    </div>

    <!-- Pokémon Container -->
    <div class="pokemoncontainer grid grid-cols-4 mt-4 justify-center text-black">
        {% if user_pokemons %}
            {% for poke in user_pokemons %}
                <div class="pokemon border-2 border-black rounded-lg p-4 w-full mx-2 my-2 cursor-pointer text-center">
                    <!-- Profile Image (if available) -->
                    <div class="profile-image-container ml-16">
                        {% if current_user.profile_image %}
                            <img id="profile-image" src="{{ url_for('static', filename='profile_pics/' + current_user.profile_image) }}" class="h-24 w-24 rounded-full" alt="{{ current_user.name }}'s Profile Image" onerror="this.onerror=null;this.src='{{ url_for('static', filename='profile_pics/profile.png') }}';" />
                        {% else %}
                            <img id="profile-image" src="{{ url_for('static', filename='profile_pics/default.png') }}" class="h-16 w-16 rounded-full" alt="Default Profile Image">
                        {% endif %}
                    </div>
                    <!-- Pokemon Details -->
                    <h2 class="heading bg-pink-600 text-xl">{{ poke.name }}</h2>
                    <p class="id hover:text-blue-800">ID: {{ poke.id }}</p>
                    <img src="{{ poke.image_url }}" alt="{{ poke.name }}" class="w-full rounded-md mb-4 h-52">
                    <div class="h-36 mb-4">
                        <p class="description inline">Description: {{ poke.description }}</p>
                    </div>
                    <div class="grid h-16">
                        <p class="">Height: {{ poke.height }}</p>
                        <p class="">Weight: {{ poke.weight }}</p>
                    </div>
                    <div class="grid h-16">
                        <p class="">Category: {{ poke.category }}</p>
                        <p class="">Abilities: {{ poke.abilities }}</p>
                    </div>
                    <!-- Delete and Update Buttons -->
                    <div class="grid grid-cols-2 justify-between">
                        <form onsubmit="return confirm('Are you sure you want to delete this Pokémon?');" method="post" action="/delete/{{ poke.id }}" class="mt-4">
                            <button type="submit" class="p-2 bg-red-500 rounded-md">Delete Pokemon</button>
                        </form>
                        <form method="get" action="/update/{{ poke.id }}" class="mt-4">
                            <button type="submit" class="p-2 bg-green-500 text-white rounded-md">Update Pokemon</button>
                        </form>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div>No Pokémon data available.</div>
        {% endif %}
    </div>    
    <script>
        document.getElementById('upload-btn').addEventListener('click', function() {
            var fileInput = document.getElementById('file-upload');
            var file = fileInput.files[0];
            if (file) {
                var formData = new FormData();
                formData.append('profile_image', file);
                
                fetch('/upload_profile_image', {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}'
                    }
                })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error('Network response was not ok.');
                })
                .then(data => {
                    if (data.success) {
                        document.getElementById('profile-image').src = data.profile_image_url;
                        alert('Profile image uploaded successfully.');
                    } else {
                        alert('Failed to upload profile image.');
                    }
                })
                .catch(error => {
                    console.error('There was an error with the fetch operation:', error);
                });
            } else {
                alert('No file selected.');
            }
        });
        </script>
        <script>
            function scrollToSection(sectionId) {
                var section = document.getElementById(sectionId);
                if (section) {
                    section.scrollIntoView({ behavior: 'smooth' });
                }
            }
        </script>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const editBtn = document.getElementById('edit-profile-btn');
                const fileUpload = document.getElementById('file-upload');
                const uploadBtn = document.getElementById('upload-btn');
        
                editBtn.addEventListener('click', function() {
                    fileUpload.style.display = 'block';
                    uploadBtn.style.display = 'block';
                });
            });
        </script>
</body>
</html>
